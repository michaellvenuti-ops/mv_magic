<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particle Vault v4.0 - The Oracle</title>
    <style>
        :root {
            --primary: #7b2cbf; --dark: #0a0118; --card-bg: #10002b;
            --text-light: #e0aaff; --gold: #00f5d4; --accent: #3c096c;
            --mate-glow: #ff0054;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--dark); color: var(--text-light); margin: 0; padding-bottom: 100px; }
        header { padding: 40px 20px; text-align: center; background: #10002b; border-bottom: 5px solid var(--gold); }
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
        
        .section-box { background: var(--card-bg); padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 1px solid var(--accent); position: relative; }
        
        .deck-view { display: flex; overflow-x: auto; gap: 10px; padding: 20px; background: rgba(0,0,0,0.5); border-radius: 12px; margin-bottom: 20px; min-height: 150px; align-items: center; }
        .card-3d { width: 70px; height: 100px; position: relative; transform-style: preserve-3d; transition: 0.6s; cursor: pointer; flex-shrink: 0; }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-weight: bold; border: 1px solid rgba(255,255,255,0.2); }
        .card-front { background: white; color: black; transform: rotateY(180deg); }
        .card-back { background: linear-gradient(135deg, var(--primary), var(--accent)); color: var(--gold); }
        .flipped { transform: rotateY(180deg); }
        .highlight { box-shadow: 0 0 20px var(--gold); border: 2px solid var(--gold); transform: translateY(-10px) rotateY(180deg) !important; }

        .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; justify-content: center; }
        .btn { padding: 12px 20px; border-radius: 6px; border: 1px solid var(--gold); cursor: pointer; font-weight: bold; transition: 0.3s; background: var(--primary); color: white; }
        .btn:hover { background: var(--gold); color: var(--dark); }

        /* LOCATOR STYLING */
        .locator-ui { background: rgba(0,0,0,0.4); padding: 20px; border-radius: 10px; border: 1px solid var(--gold); text-align: center; }
        select, input { background: var(--dark); color: var(--gold); border: 1px solid var(--gold); padding: 10px; border-radius: 5px; font-size: 1rem; margin: 5px; }

        .log-box { background: #000; color: var(--gold); padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; height: 150px; overflow-y: auto; border: 1px solid var(--accent); font-size: 0.85rem; }
    </style>
</head>
<body>

<header>
    <h1>The Particle Oracle</h1>
    <p>Locate any card within the Quantum Sequence</p>
</header>

<div class="container">
    <div class="section-box locator-ui">
        <h2>Quantum Card Locator</h2>
        <p>Select a card to find its current position in the stack.</p>
        <select id="locateVal">
            <option value="A">Ace</option><option value="2">2</option><option value="3">3</option>
            <option value="4">4</option><option value="5">5</option><option value="6">6</option>
            <option value="7">7</option><option value="8">8</option><option value="9">9</option>
            <option value="10">10</option><option value="J">Jack</option><option value="Q" selected>Queen</option>
            <option value="K">King</option>
        </select>
        <select id="locateSuit">
            <option value="♣">Clubs</option><option value="♥">Hearts</option>
            <option value="♠">Spades</option><option value="♦">Diamonds</option>
        </select>
        <button class="btn" onclick="locateCard()">Find Position</button>
        <h3 id="locationResult" style="color: var(--gold);">---</h3>
    </div>

    <div class="section-box">
        <div class="controls">
            <button class="btn" onclick="toggleDeckView()">Toggle Identity (Flip)</button>
            <button class="btn" onclick="runOutFaro()">Perform Out-Faro</button>
            <button class="btn" onclick="initStack()" style="background:#444;">Reset Oracle</button>
        </div>

        <div class="deck-view" id="deckDisplay"></div>
        <div class="log-box" id="historyLog"></div>
    </div>
</div>

<script>
    const baseSeq = ["Q", "J", "2", "6", "A", "5", "K", "10", "9", "4", "3", "7", "8"];
    let deck = [];
    let isFaceUp = false;
    let foundIdx = -1;

    function initStack() {
        deck = [];
        ['C','H','S','D'].forEach(s => {
            baseSeq.forEach(v => {
                deck.push({ 
                    n: v, 
                    s: (s==='C'?'♣':s==='H'?'♥':s==='S'?'♠':'♦'), 
                    isRed: (s==='H'||s==='D'),
                    id: v + (s==='C'?'♣':s==='H'?'♥':s==='S'?'♠':'♦')
                });
            });
        });
        foundIdx = -1;
        updateLog("ORACLE RESET: Particle Order Established.");
        render();
    }

    function toggleDeckView() {
        isFaceUp = !isFaceUp;
        render();
    }

    function runOutFaro() {
        let p1 = deck.slice(0, 26), p2 = deck.slice(26), res = [];
        for(let i=0; i<26; i++) { res.push(p1[i]); res.push(p2[i]); }
        deck = res;
        updateLog("SHUFFLE: Perfect Out-Faro executed.");
        render();
    }

    function locateCard() {
        const val = document.getElementById('locateVal').value;
        const suit = document.getElementById('locateSuit').value;
        const targetId = val + suit;
        
        foundIdx = deck.findIndex(card => card.id === targetId);
        
        if (foundIdx !== -1) {
            document.getElementById('locationResult').innerText = `${targetId} is at Position: ${foundIdx + 1}`;
            updateLog(`LOCATOR: Found ${targetId} at ${foundIdx + 1}`);
            render();
            // Auto-scroll to the card
            const container = document.getElementById('deckDisplay');
            const cardEl = container.children[foundIdx];
            cardEl.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }
    }

    function render() {
        const display = document.getElementById('deckDisplay');
        display.innerHTML = '';

        deck.forEach((c, i) => {
            let cardDiv = document.createElement('div');
            // Highlight if it's the one we looked for
            let isFound = (i === foundIdx);
            cardDiv.className = `card-3d ${isFaceUp || isFound ? 'flipped' : ''} ${isFound ? 'highlight' : ''}`;
            cardDiv.onclick = () => {
                deck = [...deck.slice(i + 1), ...deck.slice(0, i + 1)];
                foundIdx = -1;
                updateLog(`CUT: Deck cut at position ${i+1}`);
                render();
            };
            cardDiv.innerHTML = `
                <div class="card-face card-back">${i+1}</div>
                <div class="card-face card-front" style="color:${c.isRed?'#ff0054':'black'}">${c.n}${c.s}</div>
            `;
            display.appendChild(cardDiv);
        });
    }

    function updateLog(msg) {
        const log = document.getElementById('historyLog');
        log.innerHTML = `<div>> ${msg}</div>` + log.innerHTML;
    }

    initStack();
</script>
</body>
</html>
