<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Particle Stack - Player 1 Victory</title>
    <style>
        :root {
            --primary: #7b2cbf; --dark: #0a0118; --card-bg: #10002b;
            --text-light: #e0aaff; --gold: #00f5d4; --accent: #3c096c;
            --mate-glow: #ff0054;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--dark); color: var(--text-light); margin: 0; padding-bottom: 100px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .main-header { padding: 30px 20px; text-align: center; background: #10002b; border-bottom: 5px solid var(--gold); margin-bottom: 20px; }
        .main-header h1 { margin: 0; font-size: 2rem; color: var(--gold); text-transform: uppercase; }

        .simulator-box { background: var(--card-bg); padding: 25px; border-radius: 20px; border: 2px solid var(--primary); margin-bottom: 30px; }
        
        .deck-view { display: flex; overflow-x: auto; gap: 8px; padding: 15px; background: rgba(0,0,0,0.5); border-radius: 12px; margin-bottom: 15px; min-height: 140px; align-items: center; border: 1px solid var(--accent); }
        .card-3d { width: 65px; height: 95px; position: relative; transform-style: preserve-3d; transition: 0.6s; cursor: pointer; flex-shrink: 0; }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-weight: bold; border: 1px solid rgba(255,255,255,0.1); }
        .card-front { background: white; color: black; transform: rotateY(180deg); }
        .card-back { background: linear-gradient(135deg, var(--primary), var(--accent)); color: var(--gold); }
        .flipped { transform: rotateY(180deg); }

        .btn { padding: 10px 18px; border-radius: 6px; border: 1px solid var(--gold); cursor: pointer; font-weight: bold; transition: 0.2s; background: var(--primary); color: white; font-size: 0.75rem; text-transform: uppercase; margin: 5px; }
        .btn:hover { background: var(--gold); color: var(--dark); }
        .btn-win { background: var(--gold); color: var(--dark); border: 2px solid white; }

        .poker-area { background: #000; border: 2px solid var(--gold); padding: 20px; border-radius: 15px; margin-top: 20px; }
        .poker-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .poker-hand { padding: 15px; border-radius: 10px; border: 1px solid #333; transition: 0.3s; }
        .winner-p1 { border: 2px solid var(--gold); box-shadow: 0 0 15px var(--gold); background: rgba(0, 245, 212, 0.05); }
        .red-txt { color: var(--mate-glow); }

        .log-box { background: #000; color: var(--gold); padding: 10px; border-radius: 8px; font-family: monospace; height: 80px; overflow-y: auto; border: 1px solid var(--accent); font-size: 0.75rem; }
    </style>
</head>
<body>

<div class="container">
    <header class="main-header">
        <h1>Particle Vault v8.1</h1>
        <p>Optimized for Player 1 Poker Victory</p>
    </header>

    <div class="simulator-box">
        <div class="controls">
            <button class="btn" onclick="toggleFace()">Flip View</button>
            <button class="btn" onclick="runOutFaro()">Out-Faro</button>
            <button class="btn" onclick="runInFaro()">In-Faro</button>
            <button class="btn btn-win" onclick="pokerSimP1()">Deal Poker (P1 Wins)</button>
            <button class="btn" onclick="initStack()" style="background:#444;">Reset Stack</button>
        </div>
        <div class="deck-view" id="deckDisplay"></div>
        <div class="log-box" id="historyLog"></div>

        <div id="pokerDisplay" class="poker-area" style="display:none;">
            <h2 style="text-align:center; color:var(--gold);">POKER DEAL RESULT</h2>
            <div class="poker-grid" id="pokerTable"></div>
        </div>
    </div>
</div>

<script>
    const baseSeq = ["Q", "J", "2", "6", "A", "5", "K", "10", "9", "4", "3", "7", "8"];
    let currentDeck = [];
    let isFaceUp = false;

    function initStack() {
        currentDeck = [];
        ['C','H','S','D'].forEach(s => {
            baseSeq.forEach(v => {
                let suitSym = (s==='C'?'‚ô£':s==='H'?'‚ô•':s==='S'?'‚ô†':'‚ô¶');
                currentDeck.push({ n: v, s: suitSym, isRed: (s==='H'||s==='D'), id: v+suitSym });
            });
        });
        document.getElementById('pokerDisplay').style.display = 'none';
        updateLog("PARTICLE STACK RESTORED.");
        render();
    }

    function toggleFace() { isFaceUp = !isFaceUp; render(); }

    function runOutFaro() {
        let p1 = currentDeck.slice(0, 26), p2 = currentDeck.slice(26), res = [];
        for(let i=0; i<26; i++) { res.push(p1[i]); res.push(p2[i]); }
        currentDeck = res;
        updateLog("PERFECT OUT-FARO.");
        render();
    }

    function runInFaro() {
        let p1 = currentDeck.slice(0, 26), p2 = currentDeck.slice(26), res = [];
        for(let i=0; i<26; i++) { res.push(p2[i]); res.push(p1[i]); }
        currentDeck = res;
        updateLog("PERFECT IN-FARO.");
        render();
    }

    function pokerSimP1() {
        initStack(); // Start from clean stack
        // Perform 4 Out-Faros to set the slug
        for(let i=0; i<4; i++) runOutFaro();
        
        // No Cut needed for P1 as the Particle logic begins at Index 0
        document.getElementById('pokerDisplay').style.display = 'block';
        const table = document.getElementById('pokerTable');
        table.innerHTML = '';
        
        let hands = [[],[],[],[]];
        // Deal 5 cards to 4 players
        for(let i=0; i<20; i++) {
            hands[i % 4].push(currentDeck[i]);
        }

        hands.forEach((h, i) => {
            let div = document.createElement('div');
            div.className = `poker-hand ${i === 0 ? 'winner-p1' : ''}`;
            div.innerHTML = `<h3>${i === 0 ? 'üèÜ PLAYER 1' : 'Player ' + (i+1)}</h3>` + 
                            h.map(c => `<span class="${c.isRed?'red-txt':''}">${c.id}</span>`).join(' | ');
            table.appendChild(div);
        });
        updateLog("POKER DEAL: 4 Out-Faros. Player 1 receives the winning Particle hand.");
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function render() {
        const display = document.getElementById('deckDisplay');
        display.innerHTML = '';
        currentDeck.forEach((c, i) => {
            let el = document.createElement('div');
            el.className = `card-3d ${isFaceUp ? 'flipped' : ''}`;
            el.innerHTML = `<div class="card-face card-back">${i+1}</div><div class="card-face card-front ${c.isRed?'red-txt':''}">${c.id}</div>`;
            display.appendChild(el);
        });
    }

    function updateLog(m) {
        const log = document.getElementById('historyLog');
        log.innerHTML = `<div>> ${m}</div>` + log.innerHTML;
    }

    initStack();
</script>
</body>
</html>
